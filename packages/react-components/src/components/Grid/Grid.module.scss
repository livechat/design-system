@use 'sass:math';
@use 'sass:map';
@use 'sass:string';
@use './_grid-utils.scss' as grid-utils;

$breakpoints: (
  sm: 320px,
  md: 672px,
  lg: 1024px,
  xl: 1312px,
  '2xl': 1584px,
);

$default-gutters: (
  sm: var(--spacing-4),
  md: var(--spacing-4),
  lg: var(--spacing-4),
  xl: var(--spacing-4),
  '2xl': var(--spacing-6),
);

$default-margins: (
  sm: var(--spacing-8),
  md: var(--spacing-8),
  lg: var(--spacing-8),
  xl: var(--spacing-8),
  '2xl': var(--spacing-8),
);

$grid-columns: 12;

@mixin column-styles($width) {
  flex: 0 0 $width;
  max-width: $width;
}

.grid {
  box-sizing: border-box;
  display: flex;
  flex-wrap: wrap;
  gap: var(--grid-gutter, var(--grid-gutter-sm));
  margin: var(--grid-margin, var(--grid-margin-sm));
  width: calc(100% - 2 * var(--grid-margin, var(--grid-margin-sm)));
  container-type: inline-size;

  // Add default CSS custom properties for each breakpoint
  @each $breakpoint, $gutter in $default-gutters {
    --grid-gutter-#{$breakpoint}: #{$gutter};
  }

  @each $breakpoint, $margin in $default-margins {
    --grid-margin-#{$breakpoint}: #{$margin};
  }

  // Alignment styles
  &.align-start {
    align-items: flex-start;
  }

  &.align-center {
    align-items: center;
  }

  &.align-end {
    align-items: flex-end;
  }

  &.justify-start {
    justify-content: flex-start;
  }

  &.justify-center {
    justify-content: center;
  }

  &.justify-end {
    justify-content: flex-end;
  }

  &.justify-space-between {
    justify-content: space-between;
  }

  &.justify-space-around {
    justify-content: space-around;
  }
}

// Generate column classes for each breakpoint
@each $breakpoint in map.keys($breakpoints) {
  @container (min-width: map.get($breakpoints, $breakpoint)) {
    @for $i from 1 through $grid-columns {
      .column#{grid-utils.capitalize($breakpoint)}#{$i} {
        @include column-styles(
          calc(
            100% * $i / $grid-columns - ($grid-columns - $i) *
              (var(--grid-gutter, 1px) / $grid-columns)
          )
        );
      }
    }

    .column#{grid-utils.capitalize($breakpoint)}Auto {
      flex: 1 1 auto;
      max-width: 100%;
    }
  }
}
